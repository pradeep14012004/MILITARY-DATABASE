<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Military Assignments</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #000; /* Black background */
            color: #fff; /* White font */
        }

        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #333; /* Dark gray container background */
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(255, 255, 255, 0.1); /* Subtle white shadow */
        }

        h1 {
            text-align: center;
            color: #fff; /* White font for headings */
        }

        .form-container, .table-container {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #fff; /* White font for labels */
        }

        input, button {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #555; /* Darker border */
            border-radius: 4px;
            font-size: 16px;
            background-color: #222; /* Darker input background */
            color: #fff; /* White font for inputs */
        }

        button {
            background-color: #007bff; /* Blue button background */
            color: #fff; /* White font for buttons */
            border: none;
            cursor: pointer;
        }

        button:hover {
            background-color: #0056b3; /* Darker blue on hover */
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: #222; /* Darker table background */
            color: #fff; /* White font for table */
        }

        th, td {
            padding: 10px;
            text-align: left;
            border: 1px solid #555; /* Darker border for table cells */
        }

        th {
            background-color: #444; /* Darker gray for table headers */
        }

        tr:nth-child(even) {
            background-color: #333; /* Slightly lighter gray for even rows */
        }

        tr:hover {
            background-color: #555; /* Highlight row on hover */
        }

        .btn-container {
            display: flex;
            gap: 10px;
        }

        .btn-container button {
            flex: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Assignment Management</h1>

        <!-- Assignment Form -->
        <div class="form-container">
            <h3>Manage Assignment</h3>
            <form id="assignment-form">
                <input type="hidden" id="assignment-id">
                <label for="serviceid">Service ID:</label>
                <input type="number" id="serviceid" required>
                <label for="equipment-id">Equipment ID:</label>
                <input type="number" id="equipment-id" required>
                <label for="date-assigned">Date Assigned:</label>
                <input type="date" id="date-assigned" required>
                <label for="date-returned">Date Returned (optional):</label>
                <input type="date" id="date-returned">
                <div class="btn-container">
                    <button type="submit" id="save-assignment-btn">Save Assignment</button>
                    <button type="button" id="clear-assignment-btn">Clear Form</button>
                </div>
            </form>
        </div>

        <!-- Assignment Table -->
        <div class="table-container">
            <h3>Assignment Records</h3>
            <table id="assignments-table">
                <thead>
                    <tr>
                        <th>Assignment ID</th>
                        <th>Service ID</th>
                        <th>Equipment ID</th>
                        <th>Date Assigned</th>
                        <th>Date Returned</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Assignment records will be dynamically populated here -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        let assignments = [];

        // Handle form submission
        document.getElementById('assignment-form').addEventListener('submit', function (e) {
            e.preventDefault();

            const assignmentId = document.getElementById('assignment-id').value;
            const serviceid = parseInt(document.getElementById('serviceid').value);
            const equipmentId = parseInt(document.getElementById('equipment-id').value);
            const dateAssigned = document.getElementById('date-assigned').value;
            const dateReturned = document.getElementById('date-returned').value || null;

            const method = assignmentId ? 'PUT' : 'POST';
            const url = assignmentId
                ? `http://localhost:3001/api/assignments/${assignmentId}`
                : 'http://localhost:3001/api/assignments';

            fetch(url, {
                method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ serviceid, equipment_id: equipmentId, date_assigned: dateAssigned, date_returned: dateReturned })
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to save assignment');
                    }
                    return response.text();
                })
                .then(message => {
                    alert(message);
                    document.getElementById('assignment-form').reset();
                    document.getElementById('assignment-id').value = '';
                    renderAssignmentsTable();
                })
                .catch(error => console.error('Error saving assignment:', error));
        });

        // Clear form
        document.getElementById('clear-assignment-btn').addEventListener('click', function () {
            document.getElementById('assignment-form').reset();
            document.getElementById('assignment-id').value = '';
        });

        // Render assignments table
        function renderAssignmentsTable() {
            fetch('http://localhost:3001/api/assignments')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to fetch assignments');
                    }
                    return response.json();
                })
                .then(data => {
                    assignments = data;
                    const tableBody = document.querySelector('#assignments-table tbody');
                    tableBody.innerHTML = '';

                    if (assignments.length === 0) {
                        const row = document.createElement('tr');
                        row.innerHTML = '<td colspan="6" style="text-align: center;">No records found</td>';
                        tableBody.appendChild(row);
                        return;
                    }

                    assignments.forEach(assignment => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${assignment.assignment_id}</td>
                            <td>${assignment.serviceid}</td>
                            <td>${assignment.equipment_id}</td>
                            <td>${assignment.date_assigned}</td>
                            <td>${assignment.date_returned || 'Not returned'}</td>
                            <td>
                                <button class="edit-btn" data-id="${assignment.assignment_id}">Edit</button>
                                <button class="delete-btn" data-id="${assignment.assignment_id}">Delete</button>
                            </td>
                        `;
                        tableBody.appendChild(row);
                    });

                    // Add event listeners for edit and delete buttons
                    document.querySelectorAll('.edit-btn').forEach(btn => {
                        btn.addEventListener('click', function () {
                            const id = parseInt(this.getAttribute('data-id'));
                            editAssignment(id);
                        });
                    });

                    document.querySelectorAll('.delete-btn').forEach(btn => {
                        btn.addEventListener('click', function () {
                            const id = parseInt(this.getAttribute('data-id'));
                            deleteAssignment(id);
                        });
                    });
                })
                .catch(error => console.error('Error fetching assignments:', error));
        }

        // Edit assignment
        function editAssignment(id) {
            const assignment = assignments.find(a => a.assignment_id === id);
            if (assignment) {
                document.getElementById('assignment-id').value = assignment.assignment_id;
                document.getElementById('serviceid').value = assignment.serviceid;
                document.getElementById('equipment-id').value = assignment.equipment_id;
                document.getElementById('date-assigned').value = assignment.date_assigned;
                document.getElementById('date-returned').value = assignment.date_returned || '';
            }
        }

        // Delete assignment
        function deleteAssignment(id) {
            if (confirm(`Are you sure you want to delete assignment #${id}?`)) {
                fetch(`http://localhost:3001/api/assignments/${id}`, {
                    method: 'DELETE'
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Failed to delete assignment');
                        }
                        return response.text();
                    })
                    .then(message => {
                        alert(message);
                        renderAssignmentsTable();
                    })
                    .catch(error => console.error('Error deleting assignment:', error));
            }
        }

        // Initialize table
        renderAssignmentsTable();
    </script>
</body>
</html>
